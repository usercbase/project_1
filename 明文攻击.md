#zip明文攻击
##前言
**仅以此作为本人学习过程的记录**

转自搜狐[http://www.sohu.com/a/274916484_704736](http://www.sohu.com/a/274916484_704736)  
>我们为`zip`压缩文件所设定的密码，首先被转换成3个32bit的key，所以可能的key的组合是2^96，这是个天文数字，如果用暴力穷举的方式是不太可能的，除非你的密码比较短或者有个厉害的字典。

>压缩软件用这3个key加密所有包中的文件，也就是说，所有文件的key是一样的，如果我们能够找到这个key，就能解开所有的文件。

>如果我们找到加密压缩包中的任意一个文件，这个文件和压缩包里的文件是一样的，我们把这个文件用同样的压缩软件同样的压缩方式进行无密码的压缩，得到的文件就是我们的`Known plaintext`（已知明文）。用这个无密码的压缩包和有密码的压缩包进行比较，分析两个包中相同的那个文件，抽取出两个文件的不同点，就是那3个key了，如此就能得到key。两个相同文件在压缩包中的字节数应该相差12个byte，就是那3个key了。虽然我们还是无法通过这个key还原出密码，但是我们已经可以用这个key解开所有的文件，所以已经满足我们的要求了，毕竟对我们而言，得到解压后的文件比得到密码本身更重要。

**要求**：压缩包需求是`zip`

##正文

要求是手上有一个压缩包中的已知文件且要求文件大小大于12B，且另一个未知的压缩包的
有和已知的文件相同的`CRC32`，像下图这样  

<img src="https://raw.githubusercontent.com/picgouser/pic/master/20200204014803.png" width="60%">  

那基本就可以确认这是明文攻击。  
工具一般是用下面其中一个（暂时只提供windows的下载地址）  
`PKCRACK`下载地址[https://www.unix-ag.uni-kl.de/~conrad/krypto/pkcrack.html](https://www.unix-ag.uni-kl.de/~conrad/krypto/pkcrack.html)  
`ARCHPR`下载地址[https://pan.baidu.com/s/1qWep_yN1S8MejpFHqRJoqw](https://pan.baidu.com/s/1qWep_yN1S8MejpFHqRJoqw)
提取码：kczb

下面演示的是用`ARCHPR`进行明文攻击，选择好被攻击的文件以及已知文件的压缩包，选择明文攻击，开始。  

<img src="https://raw.githubusercontent.com/picgouser/pic/master/20200203041058.png" width="50%">   

普遍等待时间为几分钟，但由于ARCHPR的版本不同可能已经解密了但是没有自动停止这时需要手动停止。  
另外两点注意事项：  
>1. `PKCRACK`的运行环境是32位系统，64位系统不能运行。  
>2. `ARCHPR`可能出现这种情况  

<img src="https://raw.githubusercontent.com/picgouser/pic/master/20200204020301.png" width="60%">   

原因是因为，压缩原数据包的加密算法与自己压缩的加密算法不一样  
针对这种情况的解决方法：  
>1. 使用原包含已知文件和加密压缩包的压缩包作为明文  
>2. 使用与原压缩包相同的压缩应用，大概率为`7z`

